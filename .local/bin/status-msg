#!/bin/bash

# dependencies: pulseaudio (pactl), xkblayout-state-git from AUR

mute() {
	s="$1"
	default="@DEFAULT_$(echo $s | tr '[[:lower:]]' '[[:upper:]]')@"
	pactl get-$s-mute $default | awk '{print $2}'
}

vol() {
	s="$1"
	default="@DEFAULT_$(echo $s | tr '[[:lower:]]' '[[:upper:]]')@"
	pactl get-$s-volume $default | grep -o -e '[[:digit:]]\+%' | uniq
}

layout() {
	lang="$(xkblayout-state print %n)"
	[ "$lang" = "English" ] && echo "us" || echo "it"
}

sep='|'
reset='^d^^c#002b36^'
red='^b#dc322f^'
green='^b#859900^'
yellow='^b#b58900^'
blue='^b#268bd2^'
purple='^b#d33682^'
aqua='^b#2aa198^'

LAYOUT="${red} KB $(layout)"

# cpu temperature
TEMP="${green} T $(sed 's/000$/Â°C/' /sys/class/thermal/thermal_zone0/temp)"

# volume in and out
VOL_IN="MIC"
VOL_OUT="VOL"

# input 
[ "$(mute source)" = "yes" ] && VOL_IN="$VOL_IN mute" || VOL_IN="$VOL_IN $(vol source)"

# output 
[ "$(mute sink)" = "yes" ] && VOL_OUT="$VOL_OUT mute" || VOL_OUT="$VOL_OUT $(vol sink)"

# wifi
WIFI="${aqua} W $(cat /sys/class/net/wlp3s0/operstate)"

# battery
[[ "$(cat /sys/class/power_supply/BAT0/status)" = "Charging" ]] && BATS="CHR " || BATS=""
BAT="${purple} ${BATS}BAT $(cat /sys/class/power_supply/BAT0/capacity)"

# date
DATE="${blue} $(date +'%F %a %R')"

echo "$reset $LAYOUT $reset $TEMP $reset ${yellow} $VOL_IN $VOL_OUT $reset $WIFI $reset $BAT $reset $DATE"
